<html>
  <head>
    <title>History</title>
    <style>
      .history-table{
        width:80%;
        border:1px solid;
      }

      .history-table > thead > tr{
        background-color:#888888;
        color:#FFFFFF;
      }

      .history-table > tbody > tr:nth-child(odd){
        background-color:#CCCCFF;
      }
    </style>
  </head>
  <body>
    <a href="#" onclick="triggerUpdate(); return false">Trigger</a>
    <input type="text" />
    <br />
    <h2>Current Session</h2>
    <div id="current-session"></div>
    <h2>Saved History</h2>
    <div id="previous-sessions"></div>
    <script src="script/react.js"></script>
    <script src="script/react-dom.js"></script>
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
    -->
    <script type="text/Javascript">
        var Table = React.createClass({
            getInitialState:function(){
              return {rows:[]}
            },
            componentDidMount:function(){
              var _self = this;
              var eventName = "HOST:" + _self.props.eventName;
              document.addEventListener(eventName,function(e){
                  _self.setState({rows:e.detail});
              });
            },
            createCommand:function(func,id){
              return [this.props.eventName,func,id].join("/");
            },
            render: function render() {
                var _self = this;

                var thead = React.DOM.thead({key:"thead"},
                    React.DOM.tr({key:"headrow"},
                        this.props.cols.map(function (col,i) {
                            return React.DOM.th({key:i}, col);
                    }).concat(React.DOM.th({key:"action"}," "))));

                var tbody = React.DOM.tbody({key:"data-body"},this.state.rows.map(function (row,id){
                    return React.DOM.tr({key:id},
                    _self.props.cols.map(function (col,indx) {
                        var content;
                        if(col == "url"){
                          content = React.createElement(LinkCell,{href:row[col],dataCMD:_self.createCommand("goto",id)});
                        }else{
                          content = React.DOM.td({key:indx}, row[col]);
                        }
                        return content;
                    }).concat(React.createElement(ActionCell,{key:"delete" + id,dataCMD:_self.createCommand("delete",id)})));
                }));

                return React.DOM.table({className:"history-table"}, [thead, tbody]);
            }

        });

        var ActionCell = React.createClass({
          render: function(){
            var attr = {
              "data-cmd":this.props.dataCMD,
              "href": "#",
              onClick: function(e){e.preventDefault();} 
            };
            var lnk = React.DOM.a(attr,"delete");
            return React.DOM.td({},lnk);
          }
        });

        var LinkCell = React.createClass({
          render: function(){
            var attr = {
              "data-cmd":this.props.dataCMD + "/" + encodeURIComponent(this.props.href),
              "href": this.props.href,
              onClick:function(e){e.preventDefault();}
            };
            var lnk = React.DOM.a(attr,this.props.href);

            return React.DOM.td({},lnk);
          }
        });

        var curr = document.querySelector("#current-session");
        var prev = document.querySelector("#previous-sessions");
        var columns = ["title","url","date"];

        ReactDOM.render(
          React.createElement(Table,{eventName: "current",cols: columns}),
          curr
        );

        ReactDOM.render(
          React.createElement(Table,{eventName: "previous",cols: columns}),
          prev
        );

        function triggerUpdate(){
          payload = [
                             {
                               title:"Drudge Report",
                               url:"http://drudgereport.com",
                               date: new Date().toString()
                             } 
                          ];
                           
          var e = new CustomEvent('HOST:current',{detail:payload});
          document.dispatchEvent(e);
        }
    </script>
  </body>
</html>